{% if options is iterable %}

    {% if options|filter(f => f.type == 'tab_start')|length > 0 and options|filter(f => f.type == 'tab_end')|length > 0 %}
    <h2 class="nav-tab-wrapper custom-settings-page-tabs">
        {% for key,val in options %}
            {% if val.type == 'tab_start' %}
            <a href="#{{ val.name }}" class="nav-tab {% if key == 0 %}nav-tab-active{% endif %}">
            {{ val.label }}
            {% endif %}
            {% if val.type == 'tab_end' %}
            </a>
            {% endif %}
        {% endfor %}
    </h2>
    {% endif %}

    {% if options|filter(f => f.type == 'tab_start')|length > 0 and options|filter(f => f.type == 'tab_end')|length > 0 %}

        {% for key,val in options %}

        {% if val.type == 'tab_start' %}
        <table class="form-table form-table-options" role="presentation" id="for_tab_{{ val.name }}"{% if key != 0 %} style="display:none;"{% endif %}>
        <tbody>
        {% endif %}

        {% if val.type != 'tab_start' and val.type != 'tab_end' %}
        <tr
            {% if val.conditional_logic and val.conditional_logic is iterable %}
            data-conditional-logic='true'
            data-conditional-logic-action='{{ val.conditional_logic.action }}'
            data-conditional-logic-rules='{{ val.conditional_logic.rules|json_encode|e('html_attr') }}'
            {% endif %}>
            <th scope="row"><label for="{{ val.name }}">{{ val.label }} {% if val.required %} *{% endif %}</label></th>
            <td>
                {% include 'dashboard/fields/' ~ val.type ~ '.twig' with {'name': val.name, 'description': val.description, 'value': get_option(val.name), 'required': val.required ?? false} %}
            </td>
        </tr>
        {% endif %}

        {% if val.type == 'tab_end' %}
        </tbody>
        </table>
        {% endif %}

        {% endfor %}

    {% else %}

    <table class="form-table" role="presentation" id="{{ val.name }}"{% if key != 0 %} style="display:none;"{% endif %}>
        <tbody>
        {% for key,val in options %}
            {% if val.type != 'tab_start' and val.type != 'tab_end' %}
                <tr
                    {% if val.conditional_logic and val.conditional_logic is iterable %}
                    data-conditional-logic='true'
                    data-conditional-logic-action='{{ val.conditional_logic.action }}'
                    data-conditional-logic-rules='{{ val.conditional_logic.rules|json_encode|e('html_attr') }}'
                    {% endif %}>
                    <th scope="row"><label for="{{ val.name }}">{{ val.label }} {% if val.required %} *{% endif %}</label></th>
                    <td>
                        {% include 'dashboard/fields/' ~ val.type ~ '.twig' with {'name': val.name, 'description': val.description, 'value': get_option(val.name), 'required': val.required ?? false} %}
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
        </tbody>
    </table>

    {% endif %}

{% endif %}
